trigger:
  branches:
    include:
      - master
      - initial

pool:
  vmImage: ubuntu-latest

variables:
  AngularDirectory: "src"

steps:
  - task: Npm@1
    displayName: "Restore NPM Packages"
    inputs:
      command: ci
      workingDir: $(AngularDirectory)

  - task: Npm@1
    displayName: "npm build"
    inputs:
      command: custom
      customCommand: "run build -- --configuration production"
      workingDir: $(AngularDirectory)

  - task: Npm@1
    displayName: "Karma Tests"
    inputs:
      command: custom
      customCommand: "test"
      workingDir: $(AngularDirectory)

  - task: PublishTestResults@2
    displayName: "Publish test results"
    condition: succeededOrFailed()
    inputs:
      testRunner: JUnit
      testResultsFiles: "**/.reports/test-results.xml"
      failTaskOnFailedTests: true
